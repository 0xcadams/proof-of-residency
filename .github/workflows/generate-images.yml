name: generate-images

on:
  schedule:
    - cron: "*/15 * * * *"

defaults:
  run:
    working-directory: packages/generator

jobs:
  test:
    name: Generate New Images
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          ref: ${{ github.head_ref }}
          token: ${{ secrets.PAT }}
      - uses: actions/setup-node@v3
        with:
          node-version: 16
          cache: yarn
      - name: Install
        run: yarn --immutable
      - name: Install Playwright
        run: npx playwright install
      - name: Run screenshots
        run: yarn screenshots
      - name: Remove unneeded git hook
        run: rm -rf ../../.git/hooks/prepare-commit-msg
      - name: Create Pull Request
        id: cpr
        uses: peter-evans/create-pull-request@v4
        with:
          token: ${{ secrets.PAT }}
          add-paths: "*.png"
          commit-message: "feat(generator): autogenerated new images"
          delete-branch: true
          title: "feat(generator): autogenerated new images"
          body: "New images generated for minted token."
          reviewers: "@0xcadams"
